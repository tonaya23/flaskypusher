<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Cursos Pagos</title>
    <script src="https://js.pusher.com/7.0/pusher.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Registro de Cursos Pagos</h1>
    
    <form id="registroForm">
        <label for="telefono">Teléfono:</label>
        <input type="number" id="telefono" name="telefono" required>
        
        <label for="archivo">Archivo:</label>
        <input type="text" id="archivo" name="archivo" required>
        
        <button type="submit">Registrar</button>
    </form>

    <h2>Registros</h2>
    <table id="registrosTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Teléfono</th>
                <th>Archivo</th>
            </tr>
        </thead>
        <tbody>
            <!-- Los registros se insertarán aquí dinámicamente -->
        </tbody>
    </table>

    <script>
        // Configuración de Pusher
        var pusher = new Pusher('84b47e81b86f0dd58c26', {
            cluster: 'us2'
        });

        var channel = pusher.subscribe('canal_cursos_pagos');
        channel.bind('nuevo_curso_pago', function(data) {
            addRowToTable(data);
        });

        // Función para agregar una fila a la tabla
        function addRowToTable(data) {
            $('#registrosTable tbody').append(`
                <tr>
                    <td>${data.id || 'N/A'}</td>
                    <td>${data.telefono}</td>
                    <td>${data.archivo}</td>
                </tr>
            `);
        }

        // Manejar el envío del formulario
        $('#registroForm').submit(function(e) {
            e.preventDefault();
            $.post('/registrar', $(this).serialize(), function(response) {
                alert('Registro exitoso');
                $('#registroForm')[0].reset();
            });
        });

        // Cargar registros existentes al cargar la página
        $.get('/buscar', function(data) {
            data.forEach(addRowToTable);
        });
    </script>
</body>
</html>